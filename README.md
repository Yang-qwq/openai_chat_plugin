# OpenAI Chat Plugin

[![Version](https://img.shields.io/badge/version-0.1.2-blue.svg)](https://github.com/Yang-qwq/openai_chat_plugin)
[![License](https://img.shields.io/badge/license-AGPL-red.svg)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/)

ä¸€ä¸ªåŸºäºæ–°ç‰ˆOpenAI SDKçš„æ™ºèƒ½èŠå¤©æ’ä»¶ï¼Œä¸ºNcatBotæä¾›å¼ºå¤§çš„AIå¯¹è¯åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ¤– **æ™ºèƒ½å¯¹è¯**ï¼šæ”¯æŒå¤šç§æ¨¡å‹
- ğŸ’¬ **ç¾¤èŠç§èŠ**ï¼šåŒæ—¶æ”¯æŒç¾¤èŠå’Œç§èŠç¯å¢ƒ
- âš™ï¸ **å¤šé…ç½®æ–‡ä»¶**ï¼šæ”¯æŒè‡ªå®šä¹‰å¤šä¸ªå¯¹è¯é¢„è®¾
- ğŸ”„ **ä¼šè¯ç®¡ç†**ï¼šæ”¯æŒé‡ç½®å’Œåˆ‡æ¢å¯¹è¯é…ç½®
- ğŸ¯ **ç²¾ç¡®æ§åˆ¶**ï¼šæ”¯æŒ@æœºå™¨äººè§¦å‘å’Œç”¨æˆ·åå‰ç¼€
- ğŸ“ **å‘½ä»¤ç³»ç»Ÿ**ï¼šå®Œæ•´çš„å‘½ä»¤æ§åˆ¶ç•Œé¢
- ğŸ§  **æ™ºèƒ½ä¼šè¯ç®¡ç†**ï¼šè‡ªåŠ¨æ§åˆ¶ä¼šè¯é•¿åº¦ï¼Œä¿æŠ¤æœ€è¿‘å¯¹è¯
- âš¡ **å†…å­˜ä¼˜åŒ–**ï¼šåŠ¨æ€ä¿®å‰ªè¶…é•¿ä¼šè¯ï¼Œæå‡æ€§èƒ½

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- NcatBot æ¡†æ¶
- OpenAI API Key

## ğŸš€ å®‰è£…æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šæ‰‹åŠ¨å®‰è£…

å°†æ’ä»¶æºç æ”¾ç½®åˆ°ä½ çš„ `plugins` ç›®å½•ä¸‹ï¼š

```bash
# å…‹éš†æ’ä»¶åˆ°pluginsç›®å½•
git clone https://github.com/Yang-qwq/openai_chat_plugin.git plugins/openai_chat_plugin
```

### æ–¹æ³•äºŒï¼šGit Submodule

```bash
cd /path/to/ncatbot/
git submodule add https://github.com/Yang-qwq/openai_chat_plugin.git plugins/openai_chat_plugin
```

## âš™ï¸ é…ç½®è¯´æ˜

### 1. åŸºç¡€é…ç½®

åœ¨NcatBotå¯åŠ¨åï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹é…ç½®å‘½ä»¤ï¼š

```bash
# è®¾ç½®OpenAI API Keyï¼ˆå¼ºçƒˆå»ºè®®ç§èŠå‘é€ï¼‰
/cfg OpenAIChatPlugin.api_key sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# è®¾ç½®OpenAI API Base URLï¼ˆå¯é€‰ï¼‰
/cfg OpenAIChatPlugin.base_url https://api.openai.com/v1

# è®¾ç½®ä½¿ç”¨çš„æ¨¡å‹
/cfg OpenAIChatPlugin.model gpt-3.5-turbo

# è®¾ç½®æ˜¯å¦å¿…é¡»@æœºå™¨äººæ‰èƒ½è§¦å‘å¯¹è¯
/cfg OpenAIChatPlugin.must_at_bot true

# è®¾ç½®æ˜¯å¦åœ¨æ¶ˆæ¯å‰æ·»åŠ ç”¨æˆ·åå‰ç¼€ï¼ˆéœ€è¦åœ¨promptä¸­å£°æ˜ï¼‰
# å¼€å¯ä¹‹åï¼Œå‘ç»™æœºå™¨äººçš„æ¶ˆæ¯ä¼šè‡ªåŠ¨æ·»åŠ ç”¨æˆ·åå‰ç¼€
# ä¾‹å¦‚`User(ID): ä½ å¥½`ï¼Œåˆ™ä¼šåœ¨æ¶ˆæ¯å‰æ·»åŠ `User(ID): `ä½œä¸ºå‰ç¼€
/cfg OpenAIChatPlugin.insert_userdata_as_prefix false

# æ ‡è®°é…ç½®å®Œæˆ
/cfg OpenAIChatPlugin.is_configured true
```

### 2. é…ç½®æ–‡ä»¶è®¾ç½®

åœ¨v0.1.0ç‰ˆæœ¬å³ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œä½ æ— éœ€åœ¨config.yamlä¸­ç¼–è¾‘é¢„è®¾ï¼Œæ’ä»¶ä¼šåœ¨`data/openai_chat_plugin/presents/`ç›®å½•ä¸­è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†é¢„è®¾é…ç½®æ–‡ä»¶ã€‚

æƒ³è¦ç¼–è¾‘é¢„è®¾é…ç½®ï¼Œå¯ä»¥ç›´æ¥ç¼–è¾‘å¯¹åº”çš„`prompt.md`æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œè®¾ç½®ï¼š

```bash
your_editor data/openai_chat_plugin/presents/default/prompt.md
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åŸºç¡€å¯¹è¯

- **ç¾¤èŠ**ï¼šåœ¨ç¾¤èŠä¸­@æœºå™¨äººå³å¯å¼€å§‹å¯¹è¯
- **ç§èŠ**ï¼šç›´æ¥å‘é€æ¶ˆæ¯å³å¯å¼€å§‹å¯¹è¯

### å‘½ä»¤ç³»ç»Ÿ

#### è®¾ç½®é…ç½®æ–‡ä»¶

```bash
# ä¸ºå½“å‰ç¯å¢ƒè®¾ç½®é…ç½®æ–‡ä»¶
/chat set-present programmer

# ä¸ºæŒ‡å®šç¾¤ç»„è®¾ç½®é…ç½®æ–‡ä»¶
/chat set-present programmer group:1919810

# ä¸ºæŒ‡å®šç”¨æˆ·è®¾ç½®é…ç½®æ–‡ä»¶
/chat set-present translator user:114514
```

#### é‡ç½®ä¼šè¯

```bash
# é‡ç½®å½“å‰ç¯å¢ƒä¼šè¯
/chat reset

# é‡ç½®æŒ‡å®šç¾¤ç»„ä¼šè¯
/chat reset group:1919810

# é‡ç½®æŒ‡å®šç”¨æˆ·ä¼šè¯
/chat reset user:114514
```

#### è·å–å¸®åŠ©

```bash
# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
/chat help
```

## ğŸ”§ é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹                               | ç±»å‹      | é»˜è®¤å€¼                       | è¯´æ˜                       |
|-----------------------------------|---------|---------------------------|--------------------------|
| `api_key`                         | string  | -                         | OpenAI APIå¯†é’¥             |
| `model`                           | string  | openai/gpt-4o-mini        | ä½¿ç”¨çš„AIæ¨¡å‹                  |
| `base_url`                        | string  | https://api.openai.com/v1 | APIåŸºç¡€URL                 |
| `must_at_bot`                     | boolean | True                      | ç¾¤èŠä¸­æ˜¯å¦å¿…é¡»@æœºå™¨äºº              |
| `insert_userdata_as_prefix`       | boolean | False                     | æ˜¯å¦æ’å…¥ç”¨æˆ·ä¿¡æ¯ä½œä¸ºå‰ç¼€             |
| `max_conversations`               | integer | 21                        | æ¯ä¸ªä¼šè¯çš„æœ€å¤§æ¶ˆæ¯æ•°               |
| `enable_builtin_function_calling` | boolean | False                     | æ˜¯å¦å¯ç”¨å†…ç½®å‡½æ•°è°ƒç”¨åŠŸèƒ½             |
| `allow_access_memory`             | boolean | False                     | æ˜¯å¦å…è®¸è®¿é—®ä¼šè¯è®°å¿†ï¼ˆå†…ç½®å‡½æ•°è°ƒç”¨åŠŸèƒ½éœ€è¦å¼€å¯ï¼‰ |
| `is_configured`                   | boolean | False                     | æ’ä»¶æ˜¯å¦å·²é…ç½®                  |

## ğŸ¯ é«˜çº§åŠŸèƒ½

### å¤šé…ç½®æ–‡ä»¶æ”¯æŒ

æ’ä»¶æ”¯æŒåˆ›å»ºå¤šä¸ªå¯¹è¯é¢„è®¾ï¼Œæ¯ä¸ªé¢„è®¾å¯ä»¥æœ‰ä¸åŒçš„ç³»ç»Ÿæç¤ºè¯ï¼š

```
data/openai_chat_plugin/
| -- presents/
    | -- default/
        | -- config.yaml
        | -- prompt.md  <-- ç³»ç»Ÿæç¤ºè¯æ–‡ä»¶
    | -- programmer/
        | -- config.yaml
        | -- prompt.md  <-- ç¨‹åºå‘˜é¢„è®¾çš„ç³»ç»Ÿæç¤ºè¯æ–‡ä»¶
    | -- translator/
        | -- config.yaml
        | -- prompt.md  <-- ç¿»è¯‘é¢„è®¾çš„ç³»ç»Ÿæç¤ºè¯æ–‡ä»¶
    ...
```

### ä¼šè¯æŒä¹…åŒ–

- ç¾¤èŠä¼šè¯ç‹¬ç«‹å­˜å‚¨
- ç§èŠä¼šè¯ç‹¬ç«‹å­˜å‚¨
- æ”¯æŒä¼šè¯é‡ç½®å’Œé…ç½®åˆ‡æ¢

### æ™ºèƒ½ä¼šè¯ç®¡ç†

æ’ä»¶å…·å¤‡æ™ºèƒ½çš„ä¼šè¯é•¿åº¦æ§åˆ¶åŠŸèƒ½ï¼š

- **è‡ªåŠ¨ä¿®å‰ª**ï¼šå½“ä¼šè¯é•¿åº¦è¶…è¿‡ `max_conversations` é™åˆ¶æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤æœ€æ—©çš„ésystemæ¶ˆæ¯
- **ä¿æŠ¤æœ€è¿‘å¯¹è¯**ï¼šä¼˜å…ˆä¿ç•™æœ€è¿‘çš„å¯¹è¯å†…å®¹ï¼Œåˆ é™¤æœ€æ—©çš„å†å²æ¶ˆæ¯
- **é…ç½®è‡ªé€‚åº”**ï¼šæ”¯æŒåŠ¨æ€è°ƒæ•´æœ€å¤§æ¶ˆæ¯æ•°ï¼Œæ’ä»¶ä¼šè‡ªåŠ¨æ¸…ç†è¶…é•¿ä¼šè¯
- **åŒé‡æ£€æŸ¥**ï¼šåœ¨æ·»åŠ æ–°æ¶ˆæ¯å‰åéƒ½è¿›è¡Œé•¿åº¦æ£€æŸ¥ï¼Œç¡®ä¿ä¼šè¯å§‹ç»ˆç¬¦åˆé™åˆ¶
- **ä¸»åŠ¨æ¸…ç†**ï¼šæ’ä»¶åŠ è½½æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶æ¸…ç†æ‰€æœ‰è¶…é•¿ä¼šè¯

**å·¥ä½œåŸç†**ï¼š

1. æ’ä»¶å¯åŠ¨æ—¶æ£€æŸ¥æ‰€æœ‰ç°æœ‰ä¼šè¯
2. åˆ é™¤æœ€æ—©çš„ésystemæ¶ˆæ¯ï¼ˆä¿ç•™é¢„è®¾é…ç½®ï¼‰
3. æŒç»­åˆ é™¤ç›´åˆ°ä¼šè¯é•¿åº¦ç¬¦åˆé™åˆ¶
4. è®°å½•è¯¦ç»†çš„ä¿®å‰ªæ—¥å¿—ä¾¿äºè°ƒè¯•

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ’ä»¶æœªå“åº”**
    - æ£€æŸ¥ `is_configured` æ˜¯å¦è®¾ç½®ä¸º `true`
    - ç¡®è®¤API Keyæ˜¯å¦æ­£ç¡®
    - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **ç¾¤èŠä¸­@æœºå™¨äººæ— å“åº”**
    - ç¡®è®¤ `must_at_bot` è®¾ç½®
    - æ£€æŸ¥æœºå™¨äººQQå·æ˜¯å¦æ­£ç¡®

3. **é…ç½®æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯**
    - æ£€æŸ¥ `config.yaml` ä¸­çš„ `presents` é…ç½®
    - ç¡®è®¤é…ç½®æ–‡ä»¶åç§°æ‹¼å†™æ­£ç¡®

4. **ä¼šè¯é•¿åº¦å¼‚å¸¸**
    - æ£€æŸ¥ `max_conversations` é…ç½®å€¼æ˜¯å¦åˆç†
    - æŸ¥çœ‹æ—¥å¿—ç¡®è®¤è‡ªåŠ¨ä¿®å‰ªåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ
    - ç¡®è®¤é¢„è®¾é…ç½®ä¸­çš„systemæ¶ˆæ¯æ•°é‡

### æ—¥å¿—æŸ¥çœ‹

æ’ä»¶ä¼šè¾“å‡ºè¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼Œå¯ä»¥é€šè¿‡æ—¥å¿—æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š

```bash
# æŸ¥çœ‹æ’ä»¶æ—¥å¿—
tail -f logs/ncatbot.log | grep openai_chat_plugin
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v0.1.2

- âœ… **è®°å½•å½“å‰ä¼šè¯é¢„è®¾**ï¼šæ’ä»¶ä¼šè®°å½•å½“å‰ä¼šè¯ä½¿ç”¨çš„é¢„è®¾
- âœ… **å¯¹è¯æ—¥å¿—æ€»ä¼šæ‰“å°**ï¼šæ— è®ºæ˜¯å¦å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œæ’ä»¶éƒ½ä¼šåœ¨æ—¥å¿—ä¸­æ‰“å°æ¯æ¬¡å¯¹è¯çš„é¢„è®¾åç§°å’Œæ¶ˆæ¯å†…å®¹ï¼Œä¾¿äºè¿½è¸ªå’Œè°ƒè¯•

### v0.1.1

- âœ… **ä¿®å¤å†…ç½®å‡½æ•°è°ƒç”¨å…¼å®¹æ€§é—®é¢˜**ï¼šä¿®å¤äº†åœ¨æŸäº›ç¯å¢ƒä¸‹å†…ç½®å‡½æ•°è°ƒç”¨å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œçš„é—®é¢˜ï¼Œæå‡äº†ç¨³å®šæ€§å’Œå¯é æ€§

### v0.1.0

- âœ… **æ”¯æŒå†…ç½®Function Calling**ï¼šæ–°å¢å†…ç½®å‡½æ•°è°ƒç”¨åŠŸèƒ½ï¼Œå…è®¸æ’ä»¶è°ƒç”¨é¢„å®šä¹‰å‡½æ•°ä»¥å¢å¼ºäº¤äº’èƒ½åŠ›
- âœ… **è®°å¿†è®¿é—®æ§åˆ¶**ï¼šæ–°å¢é…ç½®é¡¹`allow_access_memory`ï¼Œæ§åˆ¶æ˜¯å¦å…è®¸è®¿é—®ä¼šè¯è®°å¿†ï¼Œæå‡å®‰å…¨æ€§å’Œéšç§ä¿æŠ¤

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªæ’ä»¶ï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## ğŸ“„ è®¸å¯è¯

æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [NcatBot](https://github.com/ncatbot/ncatbot) - ä¼˜ç§€çš„æœºå™¨äººæ¡†æ¶

---

â­ å¦‚æœè¿™ä¸ªæ’ä»¶å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStaræ”¯æŒä¸€ä¸‹ï¼
